Bucket policy World Get
 Description
 "Bucket policy allows the world to get the contents of the affected bucket"

 Suggested_action_brief
 "Remove or modify the bucket policy that enables any AWS user to get the contents of this bucket."

Detail
S3 bucket policies are a type of access control list but are different than S3 ACLs. S3 bucket policies specify what actions are allowed or denied for which principals on the bucket that the bucket policy is attached to. You attach S3 bucket policies at the bucket level, but the permissions specified in the bucket policy apply to all the objects in the bucket. 

"An S3 Bucket Policy has been added that grants public access to your bucket.  Get access has been granted to the world on the affected bucket. This allows anyone to get your bucket content. You can use bucket policies to grant permissions to individual AWS accounts; however, it is strongly recommended that you do not grant public access to your bucket unless you are absolutely certain. Consider alternative methods to provide public access to your buckets"
https://aws.amazon.com/articles/5050
https://blogs.aws.amazon.com/security/post/TxPOJBY6FE360K/IAM-policies-and-Bucket-Policies-and-ACLs-Oh-My-Controlling-Access-to-S3-Resourc

Suggested Action:
Remove the bucket permission that enables any AWS user to get the contents of this bucket.
See "Updating ACL to Remove Public Access to Your Buckets" - https://aws.amazon.com/articles/5050
Alternatives to Public Access - https://aws.amazon.com/articles/5050
To learn more about ACLs, see the following topics in Amazon S3 Developer Guide.
Access Control List (ACL) Overview - http://docs.amazonwebservices.com/AmazonS3/latest/dev/ACLOverview.html
Managing ACLs in the AWS Management Console - http://docs.amazonwebservices.com/AmazonS3/latest/dev/ManageACLsUsingConsole.html



coreo_aws_advisor_alert "world-open-policy-get" do
  action :define
  service :s3
  description "Bucket is completly readable by the world"
  category "dataloss"
  suggested_action "fix it"
  level "danger"
  objectives ["bucket_policy"]
  audit_objects ["policy"]
  formulas ["jmespath.Statement[*].[Effect,Principal,Action]"]
  operators ["=~"]
  alert_when [/"Allow",[^\]]+("AWS":"*"|"*")[^\]]+(s3:Get)/]
end
